<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„ØªØ­Ø¯ÙŠ</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>

<style>
body{
  margin:0;
  background:linear-gradient(180deg,#0f172a,#020617);
  font-family:Tajawal, sans-serif;
  color:white;
  padding:15px;
}
.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(12px);
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,0.1);
}
.btn-gold{
  background:linear-gradient(90deg,#facc15,#eab308);
  border:none;
  padding:15px;
  border-radius:15px;
  font-weight:bold;
  cursor:pointer;
}
.day{
  padding:15px;
  border-radius:15px;
  margin-bottom:12px;
}
.locked{opacity:.4;background:#1e293b;}
.active{
  background:linear-gradient(90deg,#facc15,#eab308);
  color:black;
  cursor:pointer;
}
.soon{background:#1e3a8a;}
.done{background:#064e3b;}
</style>
</head>
<body>

<h2>ğŸ”¥ Ø³Ø§Ø­Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h2>

<div class="card">
  <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
  <h1 id="totalScore">0</h1>
  <p id="progressText">0 / 29 Ø¬ÙˆÙ„Ø©</p>
</div>

<button class="btn-gold">ğŸ—º Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¹Ø§Ø±Ùƒ</button>

<br><br>

<div id="arena"></div>

<script>
const firebaseConfig = {
  apiKey: "PUT-YOUR-KEY",
  authDomain: "PUT-YOUR-DOMAIN",
  projectId: "PUT-YOUR-ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let user;
let myLogs = {};
let adminDay = 1;
let adminStatus = "closed";

auth.signInAnonymously();

auth.onAuthStateChanged(u=>{
  if(u){
    user=u;
    loadData();
  }
});

function loadData(){

  db.collection("users")
  .doc(user.uid)
  .collection("game_logs")
  .onSnapshot(snap=>{
    myLogs={};
    let total=0;

    snap.forEach(d=>{
      myLogs[d.data().day]=d.data().score;
      total+=d.data().score;
    });

    document.getElementById("totalScore").innerText=total;
    document.getElementById("progressText").innerText=
      Object.keys(myLogs).length+" / 29 Ø¬ÙˆÙ„Ø©";

    renderDays();
  });

  db.collection("settings")
  .doc("global_status")
  .onSnapshot(doc=>{
    if(doc.exists){
      adminDay=doc.data().currentDay;
      adminStatus=doc.data().status;
    }
    renderDays();
  });
}

function renderDays(){
  let html="";

  for(let i=1;i<=29;i++){

    if(myLogs[i]!==undefined){
      html+=`<div class="day done">âœ… Ø§Ù„Ø¬ÙˆÙ„Ø© ${i} - ${myLogs[i]} Ù†Ù‚Ø·Ø©</div>`;
    }
    else if(i===adminDay && adminStatus==="active"){
      html+=`<div class="day active" onclick="startQuiz(${i})">â–¶ Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}</div>`;
    }
    else if(i===adminDay && adminStatus==="soon"){
      html+=`<div class="day soon">â³ Ø§Ù„Ø¬ÙˆÙ„Ø© ${i} Ù‚Ø±ÙŠØ¨Ø§Ù‹</div>`;
    }
    else{
      html+=`<div class="day locked">ğŸ”’ Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}</div>`;
    }
  }

  document.getElementById("arena").innerHTML=html;
}

function startQuiz(day){
  alert("ÙØªØ­ Ø§Ù„Ø¬ÙˆÙ„Ø© "+day);
}
</script>

</body>
</html>
