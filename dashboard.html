<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>┘Г┘И┘К╪▓ ╪з┘Д╪▒┘Е╪╢╪з┘Ж┘К | ╪о╪▒┘К╪╖╪й ╪з┘Д╪к╪н╪п┘К╪з╪к</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { background-color: #050a15; color: white; font-family: 'Cairo', sans-serif; background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png'); overflow-x: hidden; }
        .ramadan-card { background: rgba(13, 27, 42, 0.95); border: 1px solid #b8860b; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .tab-btn { transition: 0.3s; }
        .tab-btn.active { background: linear-gradient(90deg, #b8860b, #d4af37); color: #000; font-weight: 900; }
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #timer-bar { transition: width 1s linear, background-color 0.3s; }
        .option-btn { background: #112240; border: 1px solid #233f78; transition: all 0.2s; }
        .option-btn:active { transform: scale(0.95); background: #b8860b; color: black; }
        .day-card { transition: transform 0.2s; }
        .day-card.active-day { animation: pulseGlow 2s infinite; cursor: pointer; }
        .day-card.active-day:active { transform: scale(0.98); }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 5px rgba(184,134,11,0.2); } 50% { box-shadow: 0 0 20px rgba(184,134,11,0.6); } 100% { box-shadow: 0 0 5px rgba(184,134,11,0.2); } }
    </style>
</head>
<body class="flex flex-col min-h-screen p-4 pb-10">

    <div class="flex justify-between items-center w-full max-w-lg mx-auto mb-2">
        <button onclick="window.logoutBtn()" class="text-red-400 bg-red-900/20 px-4 py-1.5 rounded-lg text-xs font-bold hover:bg-red-900/50 hover:text-white transition border border-red-900 shadow-md">
            <i class="fas fa-sign-out-alt ml-1"></i> ╪к╪│╪м┘К┘Д ╪о╪▒┘И╪м
        </button>
        <div></div> 
    </div>

    <div class="flex justify-center mb-4">
        <img src="https://i.postimg.cc/9Fpp5TVC/IMG-20260217-031514.png" class="w-24 h-24 object-contain rounded-full border-2 border-yellow-600 shadow-[0_0_15px_rgba(184,134,11,0.5)]">
    </div>

    <header class="ramadan-card flex justify-between items-center p-4 rounded-2xl mb-6 w-full max-w-lg mx-auto">
        <div class="flex items-center gap-3">
            <div class="bg-gradient-to-br from-yellow-400 to-yellow-600 w-12 h-12 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-2xl text-black"></i>
            </div>
            <div>
                <h2 id="player-name" class="font-bold text-white text-md">...</h2>
                <p id="player-group" class="text-xs text-yellow-500 font-bold">...</p>
            </div>
        </div>
        <div class="text-center bg-gray-900 p-2 rounded-xl border border-gray-700 min-w-[70px]">
            <p class="text-[10px] text-gray-400">╪з┘Д┘Ж┘В╪з╪╖</p>
            <p id="player-score" class="font-black text-xl text-yellow-500">0</p>
        </div>
    </header>

    <div class="flex bg-gray-900 rounded-xl p-1 mb-6 max-w-lg mx-auto w-full border border-gray-800">
        <button onclick="window.switchTabBtn('arena')" id="btn-arena" class="tab-btn active flex-1 py-3 text-sm rounded-lg text-gray-400 font-bold"><i class="fas fa-map-marked-alt"></i> ╪з┘Д╪к╪н╪п┘К╪з╪к</button>
        <button onclick="window.switchTabBtn('leaderboard')" id="btn-leaderboard" class="tab-btn flex-1 py-3 text-sm rounded-lg text-gray-400 font-bold"><i class="fas fa-trophy"></i> ┘Е╪м┘Е┘И╪╣╪к┘К</button>
    </div>

    <main id="tab-arena" class="tab-content active flex-grow flex flex-col items-center w-full max-w-lg mx-auto">
        <div id="days-map-container" class="w-full space-y-3">
            <div class="text-center p-10"><i class="fas fa-spinner fa-spin text-4xl text-yellow-500 mb-4"></i><p>╪м╪з╪▒┘К ╪к╪н┘Е┘К┘Д ╪з┘Д╪о╪▒┘К╪╖╪й...</p></div>
        </div>
        <div id="quiz-container" class="w-full hidden"></div>
    </main>

    <main id="tab-leaderboard" class="tab-content flex-grow w-full max-w-lg mx-auto">
        <div class="ramadan-card p-5 rounded-2xl">
            <h3 class="text-yellow-500 font-bold mb-4 text-center border-b border-gray-700 pb-2">╪к╪▒╪к┘К╪и ╪з┘Д┘Е╪м┘Е┘И╪╣╪й</h3>
            <div id="group-list" class="space-y-2"><p class="text-center text-gray-400 py-4">╪м╪з╪▒┘К ╪з┘Д╪к╪н┘Е┘К┘Д...</p></div>
        </div>
    </main>

    <div class="mt-auto pt-8 flex justify-center gap-6">
        <a href="https://www.facebook.com/share/1GmFwuYWZv/" target="_blank" class="bg-gray-800 p-3 rounded-full text-gray-400 hover:text-white hover:bg-blue-600 transition shadow-lg border border-gray-700"><i class="fab fa-facebook text-xl"></i></a>
        <a href="https://chat.whatsapp.com/D5dKR9EdHZjDPgrFpHl28J" target="_blank" class="bg-gray-800 p-3 rounded-full text-gray-400 hover:text-white hover:bg-green-600 transition shadow-lg border border-gray-700"><i class="fab fa-whatsapp text-xl"></i></a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc, onSnapshot, serverTimestamp, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // 1. ╪з┘Д╪к╪н┘В┘В ╪з┘Д┘Б┘И╪▒┘К ┘Е┘Ж ╪з┘Д┘Е╪│╪к╪о╪п┘Е ┘И╪╣╪▒╪╢ ╪и┘К╪з┘Ж╪з╪к┘З ┘В╪и┘Д ╪г┘К ╪н╪з╪м╪й
        let currentUser = null;
        try {
            const stored = localStorage.getItem('currentUser');
            if(stored) currentUser = JSON.parse(stored);
            if (!currentUser || (!currentUser.id && !currentUser.uid)) {
                window.location.replace("index.html"); 
            }
        } catch(e) { window.location.replace("index.html"); }

        const userId = currentUser.id || currentUser.uid;

        // ╪╣╪▒╪╢ ╪з┘Д╪и┘К╪з┘Ж╪з╪к ┘Б┘И╪▒╪з┘Л
        document.getElementById('player-name').innerText = currentUser.name || "┘Е╪│╪к╪о╪п┘Е";
        document.getElementById('player-group').innerText = currentUser.group || "┘Е╪м┘Е┘И╪╣╪й";
        document.getElementById('player-score').innerText = currentUser.score || 0;

        // 2. ╪е╪╣╪п╪з╪п╪з╪к ┘Б╪з┘К╪▒╪и┘К╪▓
        const firebaseConfig = { apiKey: "AIzaSyBZMnIJ_IOqeAfXqFt-m4tM1Lvo0tUDnk8", projectId: "ramadan-87817", appId: "1:343525703258:web:6776b4857425df8bcca263" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ┘Е╪к╪║┘К╪▒╪з╪к ╪з┘Д┘Ж╪╕╪з┘Е
        let quizData = []; let currentQuestion = 0; let tempScore = 0; let detailedResults = []; 
        let activeAdminDay = 1; let adminStatus = "closed"; let adminExpiry = null;
        let timerInterval; let timeLeft = 30; let isQuizActive = false; 
        let playedDaysData = {};

        // 3. ╪▒╪и╪╖ ╪з┘Д╪п┘И╪з┘Д ╪и╪з┘Д┘А window ╪╣╪┤╪з┘Ж ╪з┘Д╪▓╪▒╪з┘К╪▒ ╪к╪┤╪к╪║┘Д (┘З┘Ж╪з ┘Г╪з┘Ж ╪з┘Д╪╣┘К╪и)
        window.switchTabBtn = (tabName) => {
            if (isQuizActive) { alert("тЪая╕П ┘Д╪з ┘К┘Е┘Г┘Ж┘Г ╪з┘Д╪к┘Ж┘В┘Д ╪г╪л┘Ж╪з╪б ╪з┘Д╪з╪о╪к╪и╪з╪▒!"); return; }
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.getElementById(`btn-${tabName}`).classList.add('active');
            
            if(tabName === 'arena') {
                document.getElementById('quiz-container').classList.add('hidden');
                document.getElementById('days-map-container').classList.remove('hidden');
                renderMap();
            }
            if(tabName === 'leaderboard') fetchLeaderboard();
        };

        window.logoutBtn = () => { 
            if (isQuizActive) { alert("┘Д╪з ┘К┘Е┘Г┘Ж┘Г ╪з┘Д╪о╪▒┘И╪м ╪г╪л┘Ж╪з╪б ╪з┘Д╪з╪о╪к╪и╪з╪▒!"); return; }
            localStorage.removeItem('currentUser'); window.location.replace("index.html"); 
        };

        // 4. ╪к╪┤╪║┘К┘Д ╪з┘Д┘Ж╪╕╪з┘Е ╪з┘Д╪г╪│╪з╪│┘К
        async function bootSystem() {
            try {
                // ┘Ж╪м┘К╪и ╪з┘Д╪г┘К╪з┘Е ╪з┘Д┘Д┘К ┘Д╪╣╪и┘З╪з
                const snap = await getDocs(collection(db, "users", userId, "game_logs"));
                playedDaysData = {};
                snap.forEach(doc => { playedDaysData[doc.data().day] = doc.data().score; });
            } catch(e) { console.log("┘Д╪з ┘К┘И╪м╪п ╪│╪м┘Д╪з╪к"); }

            // ╪з┘Д╪з╪│╪к┘Е╪з╪╣ ┘Д╪н╪з┘Д╪й ╪з┘Д╪е╪п╪з╪▒╪й
            onSnapshot(doc(db, "settings", "global_status"), async (docSnap) => {
                if (!docSnap.exists()) {
                    adminStatus = "closed"; activeAdminDay = 1; renderMap(); return;
                }

                const globalData = docSnap.data();
                adminStatus = globalData.status || "closed";
                activeAdminDay = globalData.currentDay || 1;
                adminExpiry = globalData.expiryTime;

                // ╪к╪н╪п┘К╪л ╪з┘Д┘Ж┘В╪╖ ┘Е┘Ж ╪з┘Д╪│┘К╪▒┘Б╪▒ ╪и╪╡┘Е╪к
                try {
                    const uSnap = await getDoc(doc(db, "users", userId));
                    if(uSnap.exists()) {
                        currentUser.score = uSnap.data().score || currentUser.score;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        document.getElementById('player-score').innerText = currentUser.score;
                    }
                } catch(e) {}

                // ┘Д┘И ╪з┘Д┘И┘В╪к ╪о┘Д╪╡ ┘И┘З┘И ╪и┘К┘Д╪╣╪и
                if (adminExpiry && Date.now() > adminExpiry && isQuizActive) {
                    isQuizActive = false; clearInterval(timerInterval); finishQuiz(true); return;
                }

                renderMap();
            });
        }

        // 5. ╪▒╪│┘Е ╪з┘Д╪о╪▒┘К╪╖╪й
        function renderMap() {
            if (isQuizActive) return; 
            const container = document.getElementById('days-map-container');
            let html = '';

            for (let i = 1; i <= 30; i++) {
                if (playedDaysData[i] !== undefined) {
                    html += `<div class="day-card bg-gray-900 border border-green-700 p-4 rounded-xl flex justify-between items-center opacity-80"><div class="flex items-center gap-3"><div class="bg-green-900/50 w-10 h-10 rounded-full flex items-center justify-center text-green-500"><i class="fas fa-check"></i></div><div><h3 class="font-bold text-gray-200">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-xs text-green-400">╪к┘Е ╪з┘Д╪е┘Ж╪м╪з╪▓ ╪и┘Ж╪м╪з╪н</p></div></div><div class="text-center"><p class="text-[10px] text-gray-500">╪з┘Д┘Ж╪к┘К╪м╪й</p><p class="font-black text-yellow-500">${playedDaysData[i]}</p></div></div>`;
                } else if (i === activeAdminDay) {
                    if (adminStatus === 'active') {
                        if (adminExpiry && Date.now() > adminExpiry) {
                            html += `<div class="day-card bg-gray-900 border border-red-900 p-4 rounded-xl flex justify-between items-center opacity-70"><div class="flex items-center gap-3"><div class="bg-red-900/50 w-10 h-10 rounded-full flex items-center justify-center text-red-500"><i class="fas fa-hourglass-end"></i></div><div><h3 class="font-bold text-gray-400">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-xs text-red-500">╪з┘Ж╪к┘З┘Й ┘И┘В╪к ╪з┘Д╪м┘И┘Д╪й</p></div></div></div>`;
                        } else {
                            html += `<div onclick="window.prepareQuiz(${i})" class="day-card active-day bg-gradient-to-r from-gray-900 to-gray-800 border-2 border-yellow-500 p-4 rounded-xl flex justify-between items-center shadow-lg"><div class="flex items-center gap-3"><div class="bg-yellow-500 w-10 h-10 rounded-full flex items-center justify-center text-black shadow-inner"><i class="fas fa-play ml-1"></i></div><div><h3 class="font-bold text-white text-lg">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-xs text-yellow-500 font-bold animate-pulse">┘Е╪к╪з╪н ╪з┘Д╪в┘Ж.. ╪з╪╢╪║╪╖ ┘Д┘Д╪и╪п╪б!</p></div></div><i class="fas fa-chevron-left text-yellow-500 opacity-50"></i></div>`;
                        }
                    } else if (adminStatus === 'soon') {
                        html += `<div class="day-card bg-gray-900 border border-blue-900 p-4 rounded-xl flex justify-between items-center opacity-80"><div class="flex items-center gap-3"><div class="bg-blue-900/50 w-10 h-10 rounded-full flex items-center justify-center text-blue-500"><i class="fas fa-clock"></i></div><div><h3 class="font-bold text-blue-100">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-xs text-blue-400">┘К┘Б╪к╪н ┘В╪▒┘К╪и╪з┘Л.. ╪з╪│╪к╪╣╪п</p></div></div></div>`;
                    } else {
                        html += `<div class="day-card bg-gray-900 border border-gray-700 p-4 rounded-xl flex justify-between items-center opacity-60"><div class="flex items-center gap-3"><div class="bg-gray-800 w-10 h-10 rounded-full flex items-center justify-center text-gray-500"><i class="fas fa-lock"></i></div><div><h3 class="font-bold text-gray-500">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-xs text-red-400">┘Е╪║┘Д┘В ╪н╪з┘Д┘К╪з┘Л ┘Е┘Ж ╪з┘Д╪е╪п╪з╪▒╪й</p></div></div></div>`;
                    }
                } else if (i < activeAdminDay) {
                    html += `<div class="day-card bg-gray-900 border border-gray-800 p-4 rounded-xl flex justify-between items-center opacity-50"><div class="flex items-center gap-3"><div class="bg-gray-800 w-10 h-10 rounded-full flex items-center justify-center text-gray-600"><i class="fas fa-times"></i></div><div><h3 class="font-bold text-gray-600">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-xs text-gray-500">╪м┘И┘Д╪й ╪│╪з╪и┘В╪й (┘Е╪║┘Д┘В╪й)</p></div></div><span class="text-xs text-red-900 font-bold border border-red-900 px-2 rounded">┘Б╪з╪ж╪к</span></div>`;
                } else {
                    html += `<div class="day-card bg-gray-900/50 border border-gray-800/50 p-4 rounded-xl flex justify-between items-center opacity-40"><div class="flex items-center gap-3"><div class="bg-gray-800/50 w-10 h-10 rounded-full flex items-center justify-center text-gray-600"><i class="fas fa-lock"></i></div><div><h3 class="font-bold text-gray-600">╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${i})</h3><p class="text-[10px] text-gray-500">┘Д┘Е ┘К╪н┘Ж ┘И┘В╪к┘З ╪и╪╣╪п</p></div></div></div>`;
                }
            }
            container.innerHTML = html;
        }

        // 6. ╪к╪м┘З┘К╪▓ ╪з┘Д┘Г┘И┘К╪▓
        window.prepareQuiz = (dayNum) => {
            document.getElementById('days-map-container').classList.add('hidden');
            const qc = document.getElementById('quiz-container');
            qc.classList.remove('hidden');

            qc.innerHTML = `<div class="ramadan-card p-8 text-center w-full shadow-2xl mt-4"><div class="bg-gradient-to-br from-yellow-500 to-yellow-700 w-24 h-24 mx-auto rounded-full flex items-center justify-center mb-6 shadow-inner border-4 border-gray-900"><i class="fas fa-play text-4xl text-black ml-2"></i></div><h2 class="text-2xl font-black text-white mb-3">╪к╪м┘З┘К╪▓ ╪к╪н╪п┘К ╪з┘Д┘К┘И┘Е (${dayNum})</h2><p class="text-gray-300 text-sm mb-6 leading-relaxed bg-gray-900/50 p-4 rounded-lg border border-gray-800"><i class="fas fa-exclamation-triangle text-yellow-500 mr-1"></i> ┘Д╪п┘К┘Г 30 ╪л╪з┘Ж┘К╪й ┘Д┘Г┘Д ╪│╪д╪з┘Д.<br><span class="text-red-400 font-bold">╪к┘Ж╪и┘К┘З ╪н╪з╪▓┘Е:</span> ╪з┘Д╪о╪▒┘И╪м ┘Е┘Ж ╪з┘Д╪╡┘Б╪н╪й ╪г┘И ╪з┘Д╪к╪и╪п┘К┘Д ╪│┘К╪д╪п┘К ┘Д╪е┘Ж┘З╪з╪б ╪з┘Д╪з╪о╪к╪и╪з╪▒ ┘Б┘И╪▒╪з┘Л!</p><button onclick="window.runQuiz(${dayNum})" class="w-full bg-gradient-to-r from-yellow-600 to-yellow-500 text-black font-black py-4 rounded-xl shadow-lg text-lg transition active:scale-95">╪п╪о┘И┘Д ╪з┘Д┘Е┘Д╪╣╪и тЪ╜</button><button onclick="window.switchTabBtn('arena')" class="w-full mt-4 text-gray-500 text-sm hover:text-white">╪▒╪м┘И╪╣ ┘Д┘Д╪о╪▒┘К╪╖╪й</button></div>`;
        };

        // 7. ╪│╪н╪и ┘И╪и╪п╪б ╪з┘Д┘Г┘И┘К╪▓
        window.runQuiz = async (dayNum) => {
            const qc = document.getElementById('quiz-container');
            qc.innerHTML = `<div class="ramadan-card p-10 text-center mt-4"><i class="fas fa-spinner fa-spin text-5xl text-yellow-500 mb-4"></i><p class="font-bold">╪│╪н╪и ╪з┘Д╪г╪│╪ж┘Д╪й...</p></div>`;
            try {
                const snap = await getDoc(doc(db, "quizzes_pool", `day_${dayNum}`));
                if (snap.exists() && snap.data().variations?.length > 0) {
                    const vars = snap.data().variations;
                    quizData = vars[Math.floor(Math.random() * vars.length)].questions;
                    currentQuestion = 0; tempScore = 0; detailedResults = []; isQuizActive = true; 
                    showCurrentQuestion();
                } else {
                    qc.innerHTML = `<div class="ramadan-card p-8 text-center text-red-400 mt-4"><p>╪о╪╖╪г: ╪з┘Д╪е╪п╪з╪▒╪й ┘Д┘Е ╪к╪▒┘Б╪╣ ╪г╪│╪ж┘Д╪й ╪и╪╣╪п.</p><button onclick="window.switchTabBtn('arena')" class="mt-4 bg-gray-800 text-white px-4 py-2 rounded">╪▒╪м┘И╪╣</button></div>`;
                }
            } catch (e) { qc.innerHTML = `<div class="ramadan-card p-8 text-center text-red-400 mt-4"><p>╪о╪╖╪г ╪з╪к╪╡╪з┘Д</p><button onclick="window.switchTabBtn('arena')" class="mt-4 bg-gray-800 text-white px-4 py-2 rounded">╪▒╪м┘И╪╣</button></div>`; }
        };

        // ╪з┘Д╪г┘Е╪з┘Ж ╪╢╪п ╪з┘Д╪║╪┤
        document.addEventListener("visibilitychange", () => {
            if (document.hidden && isQuizActive) { alert("ЁЯЪл ╪з┘Д╪о╪▒┘И╪м ┘К┘Ж┘З┘К ╪з┘Д╪з╪о╪к╪и╪з╪▒!"); isQuizActive = false; clearInterval(timerInterval); finishQuiz(false); }
        });
        window.history.pushState(null, null, window.location.href);
        window.onpopstate = function () {
            if (isQuizActive) {
                if (confirm("тЪая╕П ╪з┘Д╪▒╪м┘И╪╣ ┘К┘Ж┘З┘К ╪з┘Д╪з╪о╪к╪и╪з╪▒! ╪к╪г┘Г┘К╪п╪Я")) { isQuizActive = false; clearInterval(timerInterval); finishQuiz(false); }
                else { window.history.pushState(null, null, window.location.href); }
            } else { window.history.back(); }
        };

        // 8. ╪╣╪▒╪╢ ╪з┘Д╪│╪д╪з┘Д ┘И╪з┘Д╪╣╪п╪з╪п
        function showCurrentQuestion() {
            if (currentQuestion >= quizData.length) return finishQuiz(false);
            const q = quizData[currentQuestion];
            let html = `<div class="ramadan-card p-6 w-full mt-4"><div class="flex justify-between mb-5 text-xs text-gray-400"><span>╪к╪н╪п┘К ${activeAdminDay}</span><span class="text-yellow-500">╪│╪д╪з┘Д ${currentQuestion + 1} / ${quizData.length}</span></div><div class="w-full bg-gray-900 h-3 rounded-full mb-6 border border-gray-700 p-0.5"><div id="timer-bar" class="h-full bg-green-500 w-full rounded-full"></div></div><div class="text-center mb-6"><span id="timer-text" class="text-3xl font-black text-white">30</span></div><h2 class="text-xl md:text-2xl font-bold mb-8 text-center leading-relaxed text-white">${q.q}</h2><div class="space-y-3">`;
            q.options.forEach((opt, idx) => { html += `<button onclick="window.processAnswer(${idx})" class="option-btn w-full text-right p-5 rounded-xl font-bold text-sm text-gray-200">${opt}</button>`; });
            html += `</div></div>`;
            document.getElementById('quiz-container').innerHTML = html;
            startCountdown();
        }

        function startCountdown() {
            timeLeft = 30; const timerBar = document.getElementById('timer-bar'); const timerText = document.getElementById('timer-text');
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--; timerText.innerText = timeLeft;
                timerBar.style.width = ((timeLeft / 30) * 100) + '%';
                if(timeLeft <= 10) timerBar.classList.replace('bg-green-500', 'bg-red-500'); else if(timeLeft <= 20) timerBar.classList.replace('bg-green-500', 'bg-yellow-500');
                if (timeLeft <= 0) { clearInterval(timerInterval); window.processAnswer(-1); }
            }, 1000);
        }

        window.processAnswer = (idx) => {
            clearInterval(timerInterval);
            detailedResults.push(idx === quizData[currentQuestion].correctIndex);
            if (idx === quizData[currentQuestion].correctIndex) tempScore += 1;
            currentQuestion++; showCurrentQu
