<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„ØªØ­Ø¯ÙŠ</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>

<style>
body{
  background:#0f172a;
  font-family:Tahoma;
  margin:0;
  padding:20px;
  color:white;
}
.glass-card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.1);
}
.day-active{
  background:linear-gradient(90deg,#facc15,#eab308);
  color:black;
  cursor:pointer;
  transition:.3s;
}
.day-active:hover{ transform:scale(1.02); }

#daily-msg-box{
  background:#111827;
  padding:12px;
  margin-bottom:20px;
  border-right:4px solid gold;
  display:none;
}

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup-card{
  background:#1f2937;
  padding:30px;
  border-radius:15px;
  text-align:center;
  transform:scale(.5);
  transition:.4s;
}
</style>
</head>
<body>

<h2>ğŸ”¥ Ø³Ø§Ø­Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h2>

<div id="daily-msg-box"></div>

<div id="view-arena"></div>

<!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ù„ -->
<div id="champ-popup" class="popup">
  <div id="champ-card" class="popup-card">
    <h3>ğŸ‘‘ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ù„</h3>
    <p id="champ-text"></p>
    <br>
    <button onclick="closeChamp()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
/* ğŸ”¥ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø¨ØªØ§Ø¹ØªÙƒ */
const firebaseConfig = {
  apiKey: "PUT-YOUR-KEY",
  authDomain: "PUT-YOUR-DOMAIN",
  projectId: "PUT-YOUR-ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let user;
let myLogs = {};
let adminDay = 1;
let adminStatus = "closed";

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¤Ù‚Øª */
auth.signInAnonymously();

auth.onAuthStateChanged(u=>{
  if(u){
    user = u;
    fetchAllData();
  }
});

function fetchAllData(){

  // Ù„ÙˆØ¬Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
  db.collection("users")
  .doc(user.uid)
  .collection("game_logs")
  .onSnapshot(snap=>{
    myLogs={};
    snap.forEach(d=>{
      myLogs[d.data().day]=d.data().score;
    });
    renderMap();
  });

  // Ø­Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…
  db.collection("settings")
  .doc("global_status")
  .onSnapshot(doc=>{
    if(doc.exists){
      adminDay = doc.data().currentDay || 1;
      adminStatus = doc.data().status || "closed";
    }
    renderMap();
  });

  // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ù„
  db.collection("settings")
  .doc("champData")
  .onSnapshot(doc=>{
    if(doc.exists && doc.data().message){
      if(!sessionStorage.getItem("champSeen")){
        document.getElementById("champ-text").innerText = doc.data().message;
        document.getElementById("champ-popup").style.display="flex";
        setTimeout(()=>{
          document.getElementById("champ-card").style.transform="scale(1)";
        },100);
        sessionStorage.setItem("champSeen","true");
      }
    }
  });

  // Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„ÙŠÙˆÙ…ÙŠ
  db.collection("settings")
  .doc("dailyData")
  .onSnapshot(doc=>{
    if(doc.exists && doc.data().message){
      let box=document.getElementById("daily-msg-box");
      box.innerText=doc.data().message;
      box.style.display="block";
    }
  });
}

function renderMap(){
  let container=document.getElementById("view-arena");
  let html="";

  for(let i=1;i<=29;i++){

    let played=myLogs[i]!==undefined;
    let active=(i===adminDay && adminStatus==="active");
    let soon=(i===adminDay && adminStatus==="soon");

    if(played){
      html+=`
      <div class="glass-card" style="padding:15px;margin-bottom:10px;border-right:4px solid #22c55e;">
        âœ… Ø§Ù„Ø¬ÙˆÙ„Ø© ${i} - ${myLogs[i]} Ù†Ù‚Ø·Ø©
      </div>`;
    }
    else if(active){
      html+=`
      <div class="day-active" onclick="openQuiz(${i})" style="padding:15px;margin-bottom:10px;border-radius:10px;">
        â–¶ Ø§Ù„Ø¬ÙˆÙ„Ø© ${i} - Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡
      </div>`;
    }
    else if(soon){
      html+=`
      <div class="glass-card" style="padding:15px;margin-bottom:10px;border-right:4px solid #3b82f6;">
        â³ Ø§Ù„Ø¬ÙˆÙ„Ø© ${i} - Ù‚Ø±ÙŠØ¨Ø§Ù‹
      </div>`;
    }
    else{
      html+=`
      <div class="glass-card" style="padding:15px;margin-bottom:10px;opacity:.4;">
        ğŸ”’ Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}
      </div>`;
    }
  }

  container.innerHTML=html;
}

function openQuiz(day){
  alert("ÙØªØ­ Ø§Ù„Ø¬ÙˆÙ„Ø© "+day);
}

function closeChamp(){
  document.getElementById("champ-popup").style.display="none";
}
</script>

</body>
</html>
